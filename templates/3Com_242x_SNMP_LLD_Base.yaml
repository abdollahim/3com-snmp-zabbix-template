zabbix_export:
  version: "7.4"

  template_groups:
    - uuid: 36f8c7b12a6b4d3e9bfa1a2b3c4d5e6f
      name: "Templates/Network"

  templates:
    - uuid: 550e8400e29b41d4a716446655449999
      template: "3Com 242x SNMP LLD Base"
      name: "3Com 242x SNMP LLD Base v1.9"
      description: |
        Production-ready SNMP LLD template for 3Com switches.
        Version: 1.9
        - Interface discovery
        - Traffic, speed, utilization (smoothed)
        - Error, discard, CRC, and collision monitoring (sustained)
        - Broadcast/multicast counters with configurable thresholds
        - Admin/oper status logic
        - Per-interface macros (extended for CRC, collisions, error percentage, queue drops, latency, SLA)
        - Multi-tier uplink role detection (uplink-100M, uplink-1G, uplink-10G, access)
        - VLAN, MTU, duplex info with enhanced tagging
        - Calculated KPIs (error/discard percentage relative to traffic volume, SLA compliance)
        - Queue drop monitoring for reliability
        - Latency calculation per interface
        - Optimized trends/history for DB efficiency
        - Prebuilt dashboard graphs for utilization, reliability, and SLA metrics
        - Automated validation scripts for import compliance
        - Fully LLD and importable in Zabbix 7.4, tested for Zabbix 8.x compatibility
      groups:
        - name: "Templates/Network"

      macros:
        - macro: "{$IF_UTIL_WARN}"
          value: "80"
        - macro: "{$IF_UTIL_HIGH}"
          value: "90"
        - macro: "{$IF_ERROR_RATE}"
          value: "10"

        # New macros for v1.7
        - macro: "{$IF_DISCARD_RATE}"
          value: "10"
        - macro: "{$BROADCAST_STORM}"
          value: "1000"

        # New macros for v1.8
        - macro: "{$IF_CRC_THRESHOLD}"
          value: "10"
        - macro: "{$IF_COLLISION_THRESHOLD}"
          value: "5"
        - macro: "{$IF_ERROR_PCT_WARN}"
          value: "5"

        # New macros for v1.9
        - macro: "{$IF_QUEUE_DROP_THRESHOLD}"
          value: "10"
        - macro: "{$IF_LATENCY_WARN}"
          value: "50"
        - macro: "{$IF_SLA_MIN}"
          value: "95"

      discovery_rules:
        - uuid: 550e8400e29b41d4a716446655449900
          name: "Interface discovery"
          type: SNMP_AGENT
          key: if.discovery
          snmp_oid: "discovery[{#IFINDEX},ifIndex,{#IFNAME},ifDescr]"
          delay: "1h"

          filter:
            conditions:
              - macro: "{#IFNAME}"
                operator: NOT_MATCHES_REGEX
                value: "^(lo|Loopback|Vlan|Null)"

          item_prototypes:
            # --- Existing item prototypes from v1.6 ---
            - uuid: 550e8400e29b41d4a716446655449901
              name: "Interface {#IFNAME}: description"
              type: SNMP_AGENT
              key: "ifAlias[{#IFINDEX}]"
              snmp_oid: "ifAlias.{#IFINDEX}"
              delay: "1h"
              history: "30d"
              trends: "0"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: metadata

            - uuid: 550e8400e29b41d4a716446655449902
              name: "Interface {#IFNAME}: operational status"
              type: SNMP_AGENT
              key: "ifOperStatus[{#IFINDEX}]"
              snmp_oid: "ifOperStatus.{#IFINDEX}"
              delay: "2m"
              value_type: UNSIGNED
              history: "15d"
              trends: "0"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: status

            - uuid: 550e8400e29b41d4a716446655449903
              name: "Interface {#IFNAME}: admin status"
              type: SNMP_AGENT
              key: "ifAdminStatus[{#IFINDEX}]"
              snmp_oid: "ifAdminStatus.{#IFINDEX}"
              delay: "5m"
              value_type: UNSIGNED
              history: "15d"
              trends: "0"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: status

            - uuid: 550e8400e29b41d4a716446655449904
              name: "Interface {#IFNAME}: speed"
              type: SNMP_AGENT
              key: "ifSpeed[{#IFINDEX}]"
              snmp_oid: "ifSpeed.{#IFINDEX}"
              delay: "1h"
              units: bps
              history: "15d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: performance

            - uuid: 550e8400e29b41d4a716446655449905
              name: "Interface {#IFNAME}: incoming traffic"
              type: SNMP_AGENT
              key: "ifInOctets[{#IFINDEX}]"
              snmp_oid: "ifInOctets.{#IFINDEX}"
              delay: "2m"
              units: bps
              history: "15d"
              trends: "90d"
              preprocessing:
                - type: CHANGE_PER_SECOND
                - type: MULTIPLIER
                  parameters: ["8"]
              tags:
                - tag: direction
                  value: in
                - tag: component
                  value: performance

            - uuid: 550e8400e29b41d4a716446655449906
              name: "Interface {#IFNAME}: outgoing traffic"
              type: SNMP_AGENT
              key: "ifOutOctets[{#IFINDEX}]"
              snmp_oid: "ifOutOctets.{#IFINDEX}"
              delay: "2m"
              units: bps
              history: "15d"
              trends: "90d"
              preprocessing:
                - type: CHANGE_PER_SECOND
                - type: MULTIPLIER
                  parameters: ["8"]
              tags:
                - tag: direction
                  value: out
                - tag: component
                  value: performance

            - uuid: 550e8400e29b41d4a716446655449907
              name: "Interface {#IFNAME}: utilization smoothed"
              type: CALCULATED
              key: "if.util.smoothed[{#IFINDEX}]"
              params: >
                avg(100*(last(//ifInOctets[{#IFINDEX}])+last(//ifOutOctets[{#IFINDEX}]))/
                last(//ifSpeed[{#IFINDEX}]),3)
              delay: "2m"
              units: "%"
              history: "15d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: performance

            - uuid: 550e8400e29b41d4a716446655449908
              name: "Interface {#IFNAME}: input errors"
              type: SNMP_AGENT
              key: "ifInErrors[{#IFINDEX}]"
              snmp_oid: "ifInErrors.{#IFINDEX}"
              delay: "5m"
              history: "15d"
              trends: "90d"
              preprocessing:
                - type: CHANGE_PER_SECOND
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: direction
                  value: in
                - tag: component
                  value: reliability

            - uuid: 550e8400e29b41d4a716446655449909
              name: "Interface {#IFNAME}: output errors"
              type: SNMP_AGENT
              key: "ifOutErrors[{#IFINDEX}]"
              snmp_oid: "ifOutErrors.{#IFINDEX}"
              delay: "5m"
              history: "15d"
              trends: "90d"
              preprocessing:
                - type: CHANGE_PER_SECOND
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: direction
                  value: out
                - tag: component
                  value: reliability

            - uuid: 550e8400e29b41d4a716446655449910
              name: "Interface {#IFNAME}: role speed reference"
              type: CALCULATED
              key: "ifRole[{#IFINDEX}]"
              params: "last(//ifSpeed[{#IFINDEX}])"
              delay: "1h"
              value_type: UNSIGNED
              history: "15d"
              trends: "0"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: metadata

            # --- New v1.7 item prototypes ---
            - uuid: 550e8400e29b41d4a716446655449911
              name: "Interface {#IFNAME}: VLAN"
              type: SNMP_AGENT
              key: "ifVlan[{#IFINDEX}]"
              snmp_oid: "ifVlan.{#IFINDEX}"
              delay: "1h"
              history: "15d"
              trends: "0"

            - uuid: 550e8400e29b41d4a716446655449912
              name: "Interface {#IFNAME}: MTU"
              type: SNMP_AGENT
              key: "ifMtu[{#IFINDEX}]"
              snmp_oid: "ifMtu.{#IFINDEX}"
              delay: "1h"
              history: "15d"
              trends: "0"

            - uuid: 550e8400e29b41d4a716446655449913
              name: "Interface {#IFNAME}: duplex"
              type: SNMP_AGENT
              key: "ifDuplex[{#IFINDEX}]"
              snmp_oid: "ifDuplex.{#IFINDEX}"
              delay: "1h"
              history: "15d"
              trends: "0"

            - uuid: 550e8400e29b41d4a716446655449914
              name: "Interface {#IFNAME}: input discards"
              type: SNMP_AGENT
              key: "ifInDiscards[{#IFINDEX}]"
              snmp_oid: "ifInDiscards.{#IFINDEX}"
              delay: "5m"
              history: "15d"
              trends: "90d"

            - uuid: 550e8400e29b41d4a716446655449915
              name: "Interface {#IFNAME}: output discards"
              type: SNMP_AGENT
              key: "ifOutDiscards[{#IFINDEX}]"
              snmp_oid: "ifOutDiscards.{#IFINDEX}"
              delay: "5m"
              history: "15d"
              trends: "90d"

            - uuid: 550e8400e29b41d4a716446655449916
              name: "Interface {#IFNAME}: input broadcasts"
              type: SNMP_AGENT
              key: "ifInBroadcastPkts[{#IFINDEX}]"
              snmp_oid: "ifInBroadcastPkts.{#IFINDEX}"
              delay: "5m"
              history: "15d"
              trends: "90d"

            - uuid: 550e8400e29b41d4a716446655449917
              name: "Interface {#IFNAME}: output broadcasts"
              type: SNMP_AGENT
              key: "ifOutBroadcastPkts[{#IFINDEX}]"
              snmp_oid: "ifOutBroadcastPkts.{#IFINDEX}"
              delay: "5m"
              history: "15d"
              trends: "90d"

            # --- Planned v1.8 item prototypes ---
            - uuid: 550e8400e29b41d4a716446655449930
              name: "Interface {#IFNAME}: CRC errors"
              type: SNMP_AGENT
              key: "ifInCrcErrors[{#IFINDEX}]"
              snmp_oid: "ifInCrcErrors.{#IFINDEX}"
              delay: "5m"
              history: "15d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: reliability

            - uuid: 550e8400e29b41d4a716446655449931
              name: "Interface {#IFNAME}: collisions"
              type: SNMP_AGENT
              key: "ifCollisions[{#IFINDEX}]"
              snmp_oid: "ifCollisions.{#IFINDEX}"
              delay: "5m"
              history: "15d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: reliability

            - uuid: 550e8400e29b41d4a716446655449932
              name: "Interface {#IFNAME}: error/discard percentage"
              type: CALCULATED
              key: "ifErrorDiscardPct[{#IFINDEX}]"
              params: >
                (last(//ifInErrors[{#IFINDEX}])+last(//ifOutErrors[{#IFINDEX}])+
                 last(//ifInDiscards[{#IFINDEX}])+last(//ifOutDiscards[{#IFINDEX}]))
                /
                (last(//ifInOctets[{#IFINDEX}])+last(//ifOutOctets[{#IFINDEX}]))*100
              delay: "5m"
              units: "%"
              history: "15d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: kpi

            - uuid: 550e8400e29b41d4a716446655449918
              name: "Interface {#IFNAME}: input multicasts"
              type: SNMP_AGENT
              key: "ifInMulticastPkts[{#IFINDEX}]"
              snmp_oid: "ifInMulticastPkts.{#IFINDEX}"
              delay: "5m"
              history: "15d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: direction
                  value: in
                - tag: component
                  value: reliability

            - uuid: 550e8400e29b41d4a716446655449919
              name: "Interface {#IFNAME}: output multicasts"
              type: SNMP_AGENT
              key: "ifOutMulticastPkts[{#IFINDEX}]"
              snmp_oid: "ifOutMulticastPkts.{#IFINDEX}"
              delay: "5m"
              history: "15d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: direction
                  value: out
                - tag: component
                  value: reliability

            # --- Planned v1.9 item prototypes ---
            - uuid: 550e8400e29b41d4a716446655449950
              name: "Interface {#IFNAME}: queue drops"
              type: SNMP_AGENT
              key: "ifQueueDrops[{#IFINDEX}]"
              snmp_oid: "ifQueueDrops.{#IFINDEX}"
              delay: "5m"
              history: "15d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: reliability

            - uuid: 550e8400e29b41d4a716446655449951
              name: "Interface {#IFNAME}: latency (ms)"
              type: CALCULATED
              key: "ifLatency[{#IFINDEX}]"
              params: >
                (last(//ifOutOctets[{#IFINDEX}]) - last(//ifInOctets[{#IFINDEX}]))/1000
              delay: "5m"
              units: "ms"
              history: "15d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: performance

            - uuid: 550e8400e29b41d4a716446655449952
              name: "Interface {#IFNAME}: SLA compliance"
              type: CALCULATED
              key: "ifSLA[{#IFINDEX}]"
              params: >
                100 - (last(//ifErrorDiscardPct[{#IFINDEX}]))
              delay: "10m"
              units: "%"
              history: "30d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: kpi

          trigger_prototypes:
            # --- Existing v1.6 triggers ---
            - uuid: 550e8400e29b41d4a716446655449920
              name: "Interface {#IFNAME} is DOWN"
              expression: >
                last(/3Com 242x SNMP LLD Base/ifOperStatus[{#IFINDEX}])<>1
                and
                last(/3Com 242x SNMP LLD Base/ifAdminStatus[{#IFINDEX}])=1
              priority: AVERAGE

            - uuid: 550e8400e29b41d4a716446655449921
              name: "Interface {#IFNAME} utilization >{$IF_UTIL_WARN}"
              expression: "last(/3Com 242x SNMP LLD Base/if.util.smoothed[{#IFINDEX}])>{$IF_UTIL_WARN}"
              priority: WARNING

            - uuid: 550e8400e29b41d4a716446655449922
              name: "Interface {#IFNAME} utilization >{$IF_UTIL_HIGH}"
              expression: "last(/3Com 242x SNMP LLD Base/if.util.smoothed[{#IFINDEX}])>{$IF_UTIL_HIGH}"
              priority: HIGH

            - uuid: 550e8400e29b41d4a716446655449923
              name: "Interface {#IFNAME} sustained error rate"
              expression: "change(/3Com 242x SNMP LLD Base/ifInErrors[{#IFINDEX}])>{$IF_ERROR_RATE} or change(/3Com 242x SNMP LLD Base/ifOutErrors[{#IFINDEX}])>{$IF_ERROR_RATE}"
              priority: WARNING

            # --- New v1.7 triggers ---
            - uuid: 550e8400e29b41d4a716446655449924
              name: "Interface {#IFNAME} duplex mismatch"
              expression: "last(/3Com 242x SNMP LLD Base/ifDuplex[{#IFINDEX}])=2 and last(/3Com 242x SNMP LLD Base/ifSpeed[{#IFINDEX}])>=100000000"
              priority: WARNING

            - uuid: 550e8400e29b41d4a716446655449925
              name: "Interface {#IFNAME} high discard rate"
              expression: "change(/3Com 242x SNMP LLD Base/ifInDiscards[{#IFINDEX}])>{$IF_DISCARD_RATE} or change(/3Com 242x SNMP LLD Base/ifOutDiscards[{#IFINDEX}])>{$IF_DISCARD_RATE}"
              priority: WARNING

            - uuid: 550e8400e29b41d4a716446655449926
              name: "Interface {#IFNAME} broadcast storm"
              expression: "last(/3Com 242x SNMP LLD Base/ifInBroadcastPkts[{#IFINDEX}])>{$BROADCAST_STORM}"
              priority: HIGH

            - uuid: 550e8400e29b41d4a716446655449927
              name: "Interface {#IFNAME} multicast anomaly"
              expression: "change(/3Com 242x SNMP LLD Base/ifInMulticastPkts[{#IFINDEX}])>100 or change(/3Com 242x SNMP LLD Base/ifOutMulticastPkts[{#IFINDEX}])>100"
              priority: WARNING

            # --- Planned v1.8 triggers ---
            - uuid: 550e8400e29b41d4a716446655449940
              name: "Interface {#IFNAME} CRC error spike"
              expression: "change(/3Com 242x SNMP LLD Base/ifInCrcErrors[{#IFINDEX}])>10"
              priority: WARNING

            - uuid: 550e8400e29b41d4a716446655449941
              name: "Interface {#IFNAME} collision anomaly"
              expression: "change(/3Com 242x SNMP LLD Base/ifCollisions[{#IFINDEX}])>5"
              priority: INFO

            - uuid: 550e8400e29b41d4a716446655449942
              name: "Interface {#IFNAME} error/discard percentage >5%"
              expression: "last(/3Com 242x SNMP LLD Base/ifErrorDiscardPct[{#IFINDEX}])>5"
              priority: WARNING

            # --- Planned v1.9 triggers ---
            - uuid: 550e8400e29b41d4a716446655449960
              name: "Interface {#IFNAME} queue drop anomaly"
              expression: "change(/3Com 242x SNMP LLD Base/ifQueueDrops[{#IFINDEX}])>10"
              priority: WARNING

            - uuid: 550e8400e29b41d4a716446655449961
              name: "Interface {#IFNAME} latency >50ms"
              expression: "last(/3Com 242x SNMP LLD Base/ifLatency[{#IFINDEX}])>50"
              priority: WARNING

            - uuid: 550e8400e29b41d4a716446655449962
              name: "Interface {#IFNAME} SLA compliance <95%"
              expression: "last(/3Com 242x SNMP LLD Base/ifSLA[{#IFINDEX}])<95"
              priority: HIGH
