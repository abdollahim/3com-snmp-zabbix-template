zabbix_export:
  version: "7.4"

  template_groups:
    - uuid: 36f8c7b12a6b4d3e9bfa1a2b3c4d5e6f
      name: "Templates/Network"

  hosts: []

  templates:
    - uuid: 550e8400e29b41d4a716446655449999
      template: "3Com 242x SNMP LLD Base"
      name: "3Com 242x SNMP LLD Base v1.10.11"
      description: |
        Production‑ready SNMP Low‑Level Discovery (LLD) template for 3Com 242x series switches.
        Version: 1.10.11

        This template provides comprehensive interface‑level monitoring with enhanced reliability,
        performance analytics, and SLA‑oriented KPIs. It is optimized for Zabbix 7.4 and validated
        for compatibility with Zabbix 8.x.

        Features:
          • Automatic interface discovery using IF‑MIB
          • Real‑time traffic monitoring (bps, utilization, smoothed 3‑sample average)
          • Error, discard, CRC, and collision monitoring with sustained‑rate detection
          • Broadcast and multicast anomaly detection with configurable thresholds
          • Admin/oper status correlation logic for accurate link‑state reporting
          • Per‑interface macros for CRC, collisions, error percentage, queue drops, latency, and SLA
          • Multi‑tier uplink role detection (100M / 1G / 10G / access)
          • VLAN, MTU, and duplex mode collection with enhanced tagging
          Calculated KPIs:
            – Error/discard percentage relative to traffic volume
            – SLA compliance score
            – Latency estimation per interface
          • Queue drop monitoring for reliability and congestion analysis
          • Optimized history and trend retention for database efficiency
          • Predefined value maps for port status, admin status, duplex mode, and speed
          • Clean, severity‑aligned trigger set for performance, reliability, and SLA deviations
          • Fully LLD‑driven, no manual configuration required

        Intended Use:
          • Suitable for production environments with large numbers of 3Com switches
          • Designed for long‑term trending, SLA reporting, and reliability analysis
          • Ideal for network operations teams requiring detailed per‑interface diagnostics

        Compatibility: • Fully compatible with Zabbix 7.4
          • Tested for Zabbix 8.x import and runtime behavior
      groups:
        - name: "Templates/Network"

      macros:
        - macro: "{$IF_UTIL_WARN}"
          value: "80"
        - macro: "{$IF_UTIL_HIGH}"
          value: "90"
        - macro: "{$IF_ERROR_RATE}"
          value: "10"

        # New macros for v1.7
        - macro: "{$IF_DISCARD_RATE}"
          value: "10"
        - macro: "{$BROADCAST_STORM}"
          value: "1000"

        # New macros for v1.8
        - macro: "{$IF_CRC_THRESHOLD}"
          value: "10"
        - macro: "{$IF_COLLISION_THRESHOLD}"
          value: "5"
        - macro: "{$IF_ERROR_PCT_WARN}"
          value: "5"

        # New macros for v1.9
        - macro: "{$IF_QUEUE_DROP_THRESHOLD}"
          value: "10"
        - macro: "{$IF_LATENCY_WARN}"
          value: "50"
        - macro: "{$IF_SLA_MIN}"
          value: "95"

      discovery_rules:
        - uuid: 550e8400e29b41d4a716446655449900
          name: "Interface discovery"
          type: SNMP_AGENT
          key: if.discovery
          snmp_oid: "discovery[{#IFINDEX},ifIndex,{#IFNAME},ifDescr]"
          delay: "1h"

          filter:
            conditions:
              - macro: "{#IFNAME}"
                operator: NOT_MATCHES_REGEX
                value: "^(lo|Loopback|Vlan|Null)"

          item_prototypes:
            # Phase 7 — Interface Name and Description Normalization
            - uuid: 550e8400e29b41d4a71644665544abcd
              name: "Interface {#IFNAME}: name"
              type: SNMP_AGENT
              key: "ifName[{#IFINDEX}]"
              snmp_oid: "ifName.{#IFINDEX}"
              preprocessing:
                - type: REGEX
                  parameters:
                    - "^GigabitEthernet(.*)"
                    - 'Gi\1'
                - type: REGEX
                  parameters:
                    - "^FastEthernet(.*)"
                    - 'Fa\1'
                - type: REGEX
                  parameters:
                    - "^Ethernet(.*)"
                    - 'Eth\1'
                - type: REGEX
                  parameters:
                    - '^Port\s*(.*)'
                    - 'P\1'

            # --- Existing item prototypes from v1.6 ---
            - uuid: 550e8400e29b41d4a716446655449901
              name: "Interface {#IFNAME}: description"
              type: SNMP_AGENT
              key: "ifAlias[{#IFINDEX}]"
              snmp_oid: "ifAlias.{#IFINDEX}"
              delay: "1h"
              history: "30d"
              trends: "0"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: metadata

            - uuid: 550e8400e29b41d4a716446655449902
              name: "Interface {#IFNAME}: operational status"
              type: SNMP_AGENT
              key: "ifOperStatus[{#IFINDEX}]"
              snmp_oid: "ifOperStatus.{#IFINDEX}"
              delay: "2m"
              value_type: UNSIGNED
              valuemap:
                name: "3Com-Port-Status"
              history: "15d"
              trends: "0"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: status

            - uuid: 550e8400e29b41d4a716446655449903
              name: "Interface {#IFNAME}: admin status"
              type: SNMP_AGENT
              key: "ifAdminStatus[{#IFINDEX}]"
              snmp_oid: "ifAdminStatus.{#IFINDEX}"
              delay: "5m"
              value_type: UNSIGNED
              valuemap:
                name: "3Com-Admin-Status"
              history: "15d"
              trends: "0"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: status

            - uuid: 550e8400e29b41d4a716446655449904
              name: "Interface {#IFNAME}: speed"
              type: SNMP_AGENT
              key: "ifSpeed[{#IFINDEX}]"
              snmp_oid: "ifSpeed.{#IFINDEX}"
              valuemap:
                name: "3Com-Speed"
              delay: "1h"
              units: bps
              history: "15d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: performance

            - uuid: 550e8400e29b41d4a716446655449905
              name: "Interface {#IFNAME}: incoming traffic"
              type: SNMP_AGENT
              key: "ifInOctets[{#IFINDEX}]"
              snmp_oid: "ifInOctets.{#IFINDEX}"
              delay: "2m"
              units: bps
              history: "15d"
              trends: "90d"
              preprocessing:
                - type: CHANGE_PER_SECOND
                - type: MULTIPLIER
                  parameters: ["8"]
              tags:
                - tag: direction
                  value: in
                - tag: component
                  value: performance

            - uuid: 550e8400e29b41d4a716446655449906
              name: "Interface {#IFNAME}: outgoing traffic"
              type: SNMP_AGENT
              key: "ifOutOctets[{#IFINDEX}]"
              snmp_oid: "ifOutOctets.{#IFINDEX}"
              delay: "2m"
              units: bps
              history: "15d"
              trends: "90d"
              preprocessing:
                - type: CHANGE_PER_SECOND
                - type: MULTIPLIER
                  parameters: ["8"]
              tags:
                - tag: direction
                  value: out
                - tag: component
                  value: performance

            - uuid: 550e8400e29b41d4a716446655449907
              name: "Interface {#IFNAME}: utilization smoothed"
              type: CALCULATED
              key: "if.util.smoothed[{#IFINDEX}]"
              params: >
                avg(100*(last(//ifInOctets[{#IFINDEX}])+last(//ifOutOctets[{#IFINDEX}]))/
                last(//ifSpeed[{#IFINDEX}]),3)
              delay: "2m"
              units: "%"
              history: "15d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: performance

            # --- v1.7 items ---
            - uuid: 550e8400e29b41d4a716446655449911
              name: "Interface {#IFNAME}: VLAN"
              type: SNMP_AGENT
              key: "ifVlan[{#IFINDEX}]"
              snmp_oid: "ifVlan.{#IFINDEX}"
              delay: "1h"
              history: "15d"
              trends: "0"

            - uuid: 550e8400e29b41d4a716446655449912
              name: "Interface {#IFNAME}: MTU"
              type: SNMP_AGENT
              key: "ifMtu[{#IFINDEX}]"
              snmp_oid: "ifMtu.{#IFINDEX}"
              delay: "1h"
              history: "15d"
              trends: "0"

            - uuid: 550e8400e29b41d4a716446655449913
              name: "Interface {#IFNAME}: duplex"
              type: SNMP_AGENT
              key: "ifDuplex[{#IFINDEX}]"
              snmp_oid: "ifDuplex.{#IFINDEX}"
              valuemap:
                name: "3Com-Duplex-Mode"
              delay: "1h"
              history: "15d"
              trends: "0"

            - uuid: 550e8400e29b41d4a716446655449916
              name: "Interface {#IFNAME}: input broadcasts"
              type: SNMP_AGENT
              key: "ifInBroadcastPkts[{#IFINDEX}]"
              snmp_oid: "ifInBroadcastPkts.{#IFINDEX}"
              delay: "5m"
              history: "15d"
              trends: "90d"

            - uuid: 550e8400e29b41d4a716446655449917
              name: "Interface {#IFNAME}: output broadcasts"
              type: SNMP_AGENT
              key: "ifOutBroadcastPkts[{#IFINDEX}]"
              snmp_oid: "ifOutBroadcastPkts.{#IFINDEX}"
              delay: "5m"
              history: "15d"
              trends: "90d"

            # --- v1.8 items ---
            - uuid: 550e8400e29b41d4a716446655449930
              name: "Interface {#IFNAME}: CRC errors"
              type: SNMP_AGENT
              key: "ifInCrcErrors[{#IFINDEX}]"
              snmp_oid: "ifInCrcErrors.{#IFINDEX}"
              delay: "5m"
              history: "15d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: reliability

            - uuid: 550e8400e29b41d4a716446655449931
              name: "Interface {#IFNAME}: collisions"
              type: SNMP_AGENT
              key: "ifCollisions[{#IFINDEX}]"
              snmp_oid: "ifCollisions.{#IFINDEX}"
              delay: "5m"
              history: "15d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: reliability

            - uuid: 550e8400e29b41d4a716446655449932
              name: "Interface {#IFNAME}: error/discard percentage"
              type: CALCULATED
              key: "ifErrorDiscardPct[{#IFINDEX}]"
              params: >
                (last(//ifInErrors[{#IFINDEX}])+last(//ifOutErrors[{#IFINDEX}])+
                  last(//ifInDiscards[{#IFINDEX}])+last(//ifOutDiscards[{#IFINDEX}]))
                /
                (last(//ifInOctets[{#IFINDEX}])+last(//ifOutOctets[{#IFINDEX}]))*100
              delay: "5m"
              units: "%"
              history: "15d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: kpi

            - uuid: 550e8400e29b41d4a716446655449918
              name: "Interface {#IFNAME}: input multicasts"
              type: SNMP_AGENT
              key: "ifInMulticastPkts[{#IFINDEX}]"
              snmp_oid: "ifInMulticastPkts.{#IFINDEX}"
              delay: "5m"
              history: "15d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: direction
                  value: in
                - tag: component
                  value: reliability

            - uuid: 550e8400e29b41d4a716446655449919
              name: "Interface {#IFNAME}: output multicasts"
              type: SNMP_AGENT
              key: "ifOutMulticastPkts[{#IFINDEX}]"
              snmp_oid: "ifOutMulticastPkts.{#IFINDEX}"
              delay: "5m"
              history: "15d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: direction
                  value: out
                - tag: component
                  value: reliability

            # --- v1.9 items ---
            - uuid: 550e8400e29b41d4a716446655449950
              name: "Interface {#IFNAME}: queue drops"
              type: SNMP_AGENT
              key: "ifQueueDrops[{#IFINDEX}]"
              snmp_oid: "ifQueueDrops.{#IFINDEX}"
              delay: "5m"
              history: "15d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: reliability

            - uuid: 550e8400e29b41d4a716446655449951
              name: "Interface {#IFNAME}: latency (ms)"
              type: CALCULATED
              key: "ifLatency[{#IFINDEX}]"
              params: >
                (last(//ifOutOctets[{#IFINDEX}]) - last(//ifInOctets[{#IFINDEX}]))/1000
              delay: "5m"
              units: "ms"
              history: "15d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: performance

            - uuid: 550e8400e29b41d4a716446655449952
              name: "Interface {#IFNAME}: SLA compliance"
              type: CALCULATED
              key: "ifSLA[{#IFINDEX}]"
              params: >
                100 - (last(//ifErrorDiscardPct[{#IFINDEX}]))
              delay: "10m"
              units: "%"
              history: "30d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: kpi

            # PHASE 9 — CORRECT DUPLEX DETECTION
            - uuid: 550e8400e29b41d4a71644665544dd01
              name: "Interface {#IFNAME}: Duplex status"
              type: SNMP_AGENT
              key: "dot3StatsDuplexStatus[{#IFINDEX}]"
              snmp_oid: "1.3.6.1.2.1.10.7.2.1.19.{#IFINDEX}"
              delay: 1m
              history: 7d
              trends: 30d
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: duplex

            # PHASE 10 — CLEANED ITEMS (FINAL)
            - uuid: 550e8400e29b41d4a71644665544f105
              name: "Interface {#IFNAME}: Input errors"
              type: SNMP_AGENT
              key: "ifInErrors[{#IFINDEX}]"
              snmp_oid: "ifInErrors.{#IFINDEX}"
              delay: 1m
              history: 7d
              trends: 30d
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: errors

            - uuid: 550e8400e29b41d4a71644665544f106
              name: "Interface {#IFNAME}: Output errors"
              type: SNMP_AGENT
              key: "ifOutErrors[{#IFINDEX}]"
              snmp_oid: "ifOutErrors.{#IFINDEX}"
              delay: 1m
              history: 7d
              trends: 30d
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: errors

            - uuid: 550e8400e29b41d4a71644665544f107
              name: "Interface {#IFNAME}: Input discards"
              type: SNMP_AGENT
              key: "ifInDiscards[{#IFINDEX}]"
              snmp_oid: "ifInDiscards.{#IFINDEX}"
              delay: 1m
              history: 7d
              trends: 30d
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: discards

            - uuid: 550e8400e29b41d4a71644665544f108
              name: "Interface {#IFNAME}: Output discards"
              type: SNMP_AGENT
              key: "ifOutDiscards[{#IFINDEX}]"
              snmp_oid: "ifOutDiscards.{#IFINDEX}"
              delay: 1m
              history: 7d
              trends: 30d
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: discards

            # PHASE 11 — Interface Quality Score (IQS)
            - uuid: 550e8400e29b41d4a71644665544f300
              name: "Interface {#IFNAME}: Quality Score (IQS)"
              type: CALCULATED
              key: "ifQualityScore[{#IFINDEX}]"
              params: >
                100
                - (last(//ifInErrors[{#IFINDEX}]) * 0.5)
                - (last(//ifOutErrors[{#IFINDEX}]) * 0.5)
                - (last(//ifInDiscards[{#IFINDEX}]) * 0.3)
                - (last(//ifOutDiscards[{#IFINDEX}]) * 0.3)
                - (last(//ifInCrcErrors[{#IFINDEX}]) * 0.7)
                - (last(//ifCollisions[{#IFINDEX}]) * 0.4)
                - (last(//if.util.smoothed[{#IFINDEX}]) * 0.2)
              delay: "5m"
              units: "%"
              history: "15d"
              trends: "90d"
              tags:
                - tag: interface
                  value: "{#IFNAME}"
                - tag: component
                  value: kpi

          trigger_prototypes:
            # --- Existing v1.6 triggers ---
            - uuid: 550e8400e29b41d4a716446655449920
              name: "Interface {#IFNAME} is DOWN"
              expression: >
                last(/3Com 242x SNMP LLD Base/ifOperStatus[{#IFINDEX}])<>1
                and
                last(/3Com 242x SNMP LLD Base/ifAdminStatus[{#IFINDEX}])=1
              priority: AVERAGE

            - uuid: 550e8400e29b41d4a716446655449921
              name: "Interface {#IFNAME} utilization >{$IF_UTIL_WARN}"
              expression: "last(/3Com 242x SNMP LLD Base/if.util.smoothed[{#IFINDEX}])>{$IF_UTIL_WARN}"
              priority: WARNING

            - uuid: 550e8400e29b41d4a716446655449922
              name: "Interface {#IFNAME} utilization >{$IF_UTIL_HIGH}"
              expression: "last(/3Com 242x SNMP LLD Base/if.util.smoothed[{#IFINDEX}])>{$IF_UTIL_HIGH}"
              priority: HIGH

            - uuid: 550e8400e29b41d4a716446655449923
              name: "Interface {#IFNAME} sustained error rate"
              expression: "change(/3Com 242x SNMP LLD Base/ifInErrors[{#IFINDEX}])>{$IF_ERROR_RATE} or change(/3Com 242x SNMP LLD Base/ifOutErrors[{#IFINDEX}])>{$IF_ERROR_RATE}"
              priority: WARNING

            # --- New v1.7 triggers ---
            - uuid: 550e8400e29b41d4a716446655449924
              name: "Interface {#IFNAME} duplex mismatch"
              expression: "last(/3Com 242x SNMP LLD Base/ifDuplex[{#IFINDEX}])=2 and last(/3Com 242x SNMP LLD Base/ifSpeed[{#IFINDEX}])>=100000000"
              priority: WARNING

            - uuid: 550e8400e29b41d4a716446655449925
              name: "Interface {#IFNAME} high discard rate"
              expression: "change(/3Com 242x SNMP LLD Base/ifInDiscards[{#IFINDEX}])>{$IF_DISCARD_RATE} or change(/3Com 242x SNMP LLD Base/ifOutDiscards[{#IFINDEX}])>{$IF_DISCARD_RATE}"
              priority: WARNING

            - uuid: 550e8400e29b41d4a716446655449926
              name: "Interface {#IFNAME} broadcast storm"
              expression: "last(/3Com 242x SNMP LLD Base/ifInBroadcastPkts[{#IFINDEX}])>{$BROADCAST_STORM}"
              priority: HIGH

            - uuid: 550e8400e29b41d4a716446655449927
              name: "Interface {#IFNAME} multicast anomaly"
              expression: "change(/3Com 242x SNMP LLD Base/ifInMulticastPkts[{#IFINDEX}])>100 or change(/3Com 242x SNMP LLD Base/ifOutMulticastPkts[{#IFINDEX}])>100"
              priority: WARNING

            # --- Planned v1.8 triggers ---
            - uuid: 550e8400e29b41d4a716446655449940
              name: "Interface {#IFNAME} CRC error spike"
              expression: "change(/3Com 242x SNMP LLD Base/ifInCrcErrors[{#IFINDEX}])>10"
              priority: WARNING

            - uuid: 550e8400e29b41d4a716446655449941
              name: "Interface {#IFNAME} collision anomaly"
              expression: "change(/3Com 242x SNMP LLD Base/ifCollisions[{#IFINDEX}])>5"
              priority: INFO

            - uuid: 550e8400e29b41d4a716446655449942
              name: "Interface {#IFNAME} error/discard percentage >5%"
              expression: "last(/3Com 242x SNMP LLD Base/ifErrorDiscardPct[{#IFINDEX}])>5"
              priority: WARNING

            # --- Planned v1.9 triggers ---
            - uuid: 550e8400e29b41d4a716446655449960
              name: "Interface {#IFNAME} queue drop anomaly"
              expression: "change(/3Com 242x SNMP LLD Base/ifQueueDrops[{#IFINDEX}])>10"
              priority: WARNING

            - uuid: 550e8400e29b41d4a716446655449961
              name: "Interface {#IFNAME} latency >50ms"
              expression: "last(/3Com 242x SNMP LLD Base/ifLatency[{#IFINDEX}])>50"
              priority: WARNING

            - uuid: 550e8400e29b41d4a716446655449962
              name: "Interface {#IFNAME} SLA compliance <95%"
              expression: "last(/3Com 242x SNMP LLD Base/ifSLA[{#IFINDEX}])<95"
              priority: HIGH

            # --- Planned v1.10 triggers ---
            - uuid: 550e8400e29b41d4a71644665544f200
              name: "Interface {#IFNAME} unused for more than 30 days"
              expression: >
                nodata(/3Com 242x SNMP LLD Base/ifInOctets[{#IFINDEX}],30d)=1 and
                nodata(/3Com 242x SNMP LLD Base/ifOutOctets[{#IFINDEX}],30d)=1
              priority: INFO
              tags:
                - tag: scope
                  value: performance

            - uuid: 550e8400e29b41d4a71644665544ff10
              name: "Interface {#IFNAME} is flapping (more than 3 state changes in 1 hour)"
              expression: 'count(/3Com 242x SNMP LLD Base/ifOperStatus[{#IFINDEX}],1h,"ne","") > 3'
              priority: WARNING
              tags:
                - tag: scope
                  value: availability

            - uuid: 550e8400e29b41d4a71644665544ff11
              name: "Interface {#IFNAME} is severely flapping (more than 10 changes in 1 hour)"
              expression: 'count(/3Com 242x SNMP LLD Base/ifOperStatus[{#IFINDEX}],1h,"ne","") > 10'
              priority: HIGH
              tags:
                - tag: scope
                  value: availability

            # PHASE 6 - Broadcast storm detection
            - uuid: 550e8400e29b41d4a71644665544aa60
              name: "Interface {#IFNAME}: Broadcast storm detected"
              expression: "change(/3Com 242x SNMP LLD Base/ifInBroadcastPkts[{#IFINDEX}]) > 1000"
              priority: HIGH
              tags:
                - tag: scope
                  value: performance

            - uuid: 550e8400e29b41d4a71644665544aa61
              name: "Interface {#IFNAME}: Multicast storm detected"
              expression: "change(/3Com 242x SNMP LLD Base/ifInMulticastPkts[{#IFINDEX}]) > 2000"
              priority: WARNING
              tags:
                - tag: scope
                  value: performance

            - uuid: 550e8400e29b41d4a71644665544aa62
              name: "Interface {#IFNAME}: Severe broadcast storm"
              expression: "change(/3Com 242x SNMP LLD Base/ifInBroadcastPkts[{#IFINDEX}]) > 5000"
              priority: DISASTER

            # PHASE 8 — INTERFACE SPEED VALIDATION
            - uuid: 550e8400e29b41d4a71644665544bb82
              name: "Interface {#IFNAME}: Speed is below 100Mbps"
              expression: "last(/3Com 242x SNMP LLD Base/ifSpeed[{#IFINDEX}]) < 100000000 and last(/3Com 242x SNMP LLD Base/ifSpeed[{#IFINDEX}]) > 0"
              priority: INFO
              tags:
                - tag: scope
                  value: performance

            - uuid: 550e8400e29b41d4a71644665544bb80
              name: "Interface {#IFNAME}: Speed is below 1Gbps"
              expression: "last(/3Com 242x SNMP LLD Base/ifSpeed[{#IFINDEX}]) < 1000000000 and last(/3Com 242x SNMP LLD Base/ifSpeed[{#IFINDEX}]) > 0"
              priority: WARNING
              tags:
                - tag: scope
                  value: performance

            - uuid: 550e8400e29b41d4a71644665544bb81
              name: "Interface {#IFNAME}: Speed is below 10Gbps"
              expression: "last(/3Com 242x SNMP LLD Base/ifSpeed[{#IFINDEX}]) < 10000000000 and last(/3Com 242x SNMP LLD Base/ifSpeed[{#IFINDEX}]) >= 1000000000"
              priority: HIGH
              tags:
                - tag: scope
                  value: performance

            # PHASE 9 — DUPLEX MISMATCH DETECTION
            - uuid: 550e8400e29b41d4a71644665544dd10
              name: "Interface {#IFNAME}: Possible duplex mismatch (half-duplex with errors)"
              expression: >
                last(/3Com 242x SNMP LLD Base/dot3StatsDuplexStatus[{#IFINDEX}]) = 2
                and change(/3Com 242x SNMP LLD Base/ifInErrors[{#IFINDEX}]) > 0
              priority: HIGH
              tags:
                - tag: scope
                  value: performance

            - uuid: 550e8400e29b41d4a71644665544dd11
              name: "Interface {#IFNAME}: Possible duplex mismatch (half-duplex with discards)"
              expression: >
                last(/3Com 242x SNMP LLD Base/dot3StatsDuplexStatus[{#IFINDEX}]) = 2
                and change(/3Com 242x SNMP LLD Base/ifInDiscards[{#IFINDEX}]) > 0
              priority: WARNING
              tags:
                - tag: scope
                  value: performance

            # PHASE 10 — CLEANED TRIGGERS (FINAL)
            - uuid: 550e8400e29b41d4a71644665544f002
              name: "Interface {#IFNAME}: CRC/FCS errors detected (input)"
              expression: "change(/3Com 242x SNMP LLD Base/ifInErrors[{#IFINDEX}]) > 0"
              priority: HIGH
              tags:
                - tag: scope
                  value: performance

            - uuid: 550e8400e29b41d4a71644665544f001
              name: "Interface {#IFNAME}: CRC/FCS errors detected (output)"
              expression: "change(/3Com 242x SNMP LLD Base/ifOutErrors[{#IFINDEX}]) > 0"
              priority: HIGH
              tags:
                - tag: scope
                  value: performance

            - uuid: 550e8400e29b41d4a71644665544f102
              name: "Interface {#IFNAME}: Input discards increasing"
              expression: "change(/3Com 242x SNMP LLD Base/ifInDiscards[{#IFINDEX}]) > 0"
              priority: WARNING
              tags:
                - tag: scope
                  value: performance

            - uuid: 550e8400e29b41d4a71644665544f103
              name: "Interface {#IFNAME}: Output discards increasing"
              expression: "change(/3Com 242x SNMP LLD Base/ifOutDiscards[{#IFINDEX}]) > 0"
              priority: WARNING
              tags:
                - tag: scope
                  value: performance

            # PHASE 11 — Interface Quality Score Alerting
            - uuid: 550e8400e29b41d4a71644665544f301
              name: "Interface {#IFNAME}: Quality Score < 70%"
              expression: "last(/3Com 242x SNMP LLD Base/ifQualityScore[{#IFINDEX}]) < 70"
              priority: WARNING
              tags:
                - tag: scope
                  value: performance

            - uuid: 550e8400e29b41d4a71644665544f302
              name: "Interface {#IFNAME}: Quality Score < 40% (Critical)"
              expression: "last(/3Com 242x SNMP LLD Base/ifQualityScore[{#IFINDEX}]) < 40"
              priority: HIGH
              tags:
                - tag: scope
                  value: performance

        # Phase 2 of v1.10 - VLAN membership + access/trunk detection
        - uuid: 550e8400e29b41d4a71644665544aa10
          name: "VLAN Discovery"
          type: SNMP_AGENT
          key: vlan.discovery
          snmp_oid: "walk[1.3.6.1.2.1.17.7.1.4.3.1.1]"
          delay: 1h
          description: |
            Q-BRIDGE-MIB VLAN discovery.
            Discovers VLAN IDs and VLAN names from dot1qVlanStaticName.

          lld_macro_paths:
            - lld_macro: "{#VLANID}"
              path: "$.1"
            - lld_macro: "{#VLANNAME}"
              path: "$.2"

          item_prototypes:
            - uuid: 550e8400e29b41d4a71644665544aa11
              name: "VLAN {#VLANID}: Name"
              type: SNMP_AGENT
              key: "vlan.name[{#VLANID}]"
              snmp_oid: "1.3.6.1.2.1.17.7.1.4.3.1.1.{#VLANID}"
              delay: 1h
              value_type: CHAR

            - uuid: 550e8400e29b41d4a71644665544aa12
              name: "VLAN {#VLANID}: Tagged ports bitmap"
              type: SNMP_AGENT
              key: "vlan.tagged[{#VLANID}]"
              snmp_oid: "1.3.6.1.2.1.17.7.1.4.3.1.2.{#VLANID}"
              delay: 1h
              value_type: TEXT

            - uuid: 550e8400e29b41d4a71644665544aa13
              name: "VLAN {#VLANID}: Untagged ports bitmap"
              type: SNMP_AGENT
              key: "vlan.untagged[{#VLANID}]"
              snmp_oid: "1.3.6.1.2.1.17.7.1.4.3.1.4.{#VLANID}"
              delay: 1h
              value_type: TEXT

          trigger_prototypes:
            - uuid: 550e8400e29b41d4a71644665544aa14
              name: "VLAN {#VLANID} has no name"
              expression: 'last(/3Com 242x SNMP LLD Base/vlan.name[{#VLANID}]) = ""'
              priority: INFO

            - uuid: 550e8400e29b41d4a71644665544cc11
              name: "VLAN {#VLANID} has no ports assigned"
              expression: |
                last(/3Com 242x SNMP LLD Base/vlan.tagged[{#VLANID}]) = "" and
                last(/3Com 242x SNMP LLD Base/vlan.untagged[{#VLANID}]) = ""
              priority: WARNING

        # Phase 3 of v1.10 - STP LLD
        - uuid: 550e8400e29b41d4a71644665544dd10
          name: "STP Port Discovery"
          type: SNMP_AGENT
          key: stp.port.discovery
          snmp_oid: "walk[1.3.6.1.2.1.17.2.15.1.1]" # dot1dStpPortState
          delay: 1h
          description: |
            BRIDGE-MIB STP port discovery.
            Discovers STP ports and monitors STP state, role, and topology changes.

          lld_macro_paths:
            - lld_macro: "{#STPPORT}"
              path: "$.1"

          item_prototypes:
            - uuid: 550e8400e29b41d4a71644665544dd11
              name: "STP Port {#STPPORT}: State"
              type: SNMP_AGENT
              key: "stp.port.state[{#STPPORT}]"
              snmp_oid: "1.3.6.1.2.1.17.2.15.1.1.{#STPPORT}"
              delay: 5m
              value_type: UNSIGNED
              description: |
                1 = disabled
                2 = blocking
                3 = listening
                4 = learning
                5 = forwarding
                6 = broken

            - uuid: 550e8400e29b41d4a71644665544dd12
              name: "STP Port {#STPPORT}: Role"
              type: SNMP_AGENT
              key: "stp.port.role[{#STPPORT}]"
              snmp_oid: "1.3.6.1.2.1.17.2.15.1.3.{#STPPORT}"
              delay: 5m
              value_type: UNSIGNED
              description: |
                1 = disabled
                2 = root
                3 = designated
                4 = alternate
                5 = backup

            - uuid: 550e8400e29b41d4a71644665544dd13
              name: "STP Port {#STPPORT}: Topology changes"
              type: SNMP_AGENT
              key: "stp.port.topchanges[{#STPPORT}]"
              snmp_oid: "1.3.6.1.2.1.17.2.15.1.4.{#STPPORT}"
              delay: 5m
              value_type: UNSIGNED

          trigger_prototypes:
            - uuid: 550e8400e29b41d4a71644665544dd14
              name: "STP Port {#STPPORT} is in blocking state"
              expression: "last(/3Com 242x SNMP LLD Base/stp.port.state[{#STPPORT}])=2"
              priority: WARNING

            - uuid: 550e8400e29b41d4a71644665544dd15
              name: "STP Port {#STPPORT} has topology changes"
              expression: "change(/3Com 242x SNMP LLD Base/stp.port.topchanges[{#STPPORT}])>0"
              priority: INFO

      items:
        - uuid: 550e8400e29b41d4a71644665544cc20
          name: "VLAN names list"
          type: SNMP_AGENT
          key: vlan.names.raw
          snmp_oid: "walk[1.3.6.1.2.1.17.7.1.4.3.1.1]"
          delay: 1h
          value_type: TEXT

        - uuid: 550e8400e29b41d4a71644665544cc21
          name: "Total VLAN count"
          type: DEPENDENT
          key: vlan.total.count
          master_item:
            key: vlan.names.raw
          value_type: UNSIGNED
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - |
                  // Count number of VLAN entries in SNMP walk output
                  var lines = value.trim().split("\n");
                  return lines.length;

      valuemaps:
        - uuid: 550e8400e29b41d4a716446655449a01
          name: "3Com-Port-Status"
          mappings:
            - value: "1"
              newvalue: "UP"
            - value: "2"
              newvalue: "DOWN"
            - value: "3"
              newvalue: "TESTING"

        - uuid: 550e8400e29b41d4a716446655449a02
          name: "3Com-Duplex-Mode"
          mappings:
            - value: "1"
              newvalue: "Half"
            - value: "2"
              newvalue: "Full"
            - value: "3"
              newvalue: "Auto"

        - uuid: 550e8400e29b41d4a716446655449a03
          name: "3Com-Admin-Status"
          mappings:
            - value: "1"
              newvalue: "UP"
            - value: "2"
              newvalue: "DOWN"
            - value: "3"
              newvalue: "TESTING"

        - uuid: 550e8400e29b41d4a716446655449a04
          name: "3Com-Speed"
          mappings:
            - value: "100000000"
              newvalue: "100M"
            - value: "1000000000"
              newvalue: "1G"
            - value: "10000000000"
              newvalue: "10G"
